<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layouts/layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
	$(
		function(){
// 			alert("jquery 테스트");
			$(".d").hover(function(){
				//년월일 값을 구하기
				let aDate=$(this);//hover이벤트가 발생된 a객체 구함
				let year=$(".y").text().trim();//년도
				let month=$(".m").text().trim();//월
				let date=aDate.text().trim();//일
				//날짜 8자리 변환
				let yyyyMMdd=year+(month.length<2?"0"+month:month)
				                 +(date.length<2?"0"+date:date);
						
				$.ajax({         
					url:"/schedule/calcountajax",
					method:"get",
					async:false, //ajax 코드를 비동기/동기 실행 정의
					data:{"yyyyMMdd":yyyyMMdd},
					dataType:"json", //서버로부터 받을때 타입 정의
					success:function(data){//서버로 부터 받는 데이터 data변수에 저장
// 						console.log(data);
						aDate.after("<div class='cp'>"
								    +data.count+"</div>");
					},
					error:function(){
						console.log("통신실패");
					}
				});
			},
			function(){
				$(".cp").remove();
			});
		}
	);
</script>
<style type="text/css">
	.cal #tbody > div{
		position: relative;
	}

	.cp{
		position: absolute;
    	left: 20px;
    	top:-30px;
    	width: 40px;
    	height: 40px;
    	border-radius:20px 20px 20px 1px;
    	background-color: pink;
    	line-height: 40px;
    	text-align: center;
    	font-weight: bold;
	}
</style>
</head>
<body>
<div layout:fragment="content">
	<div id="container" class="container">
		<h1>일정관리[달력보기]</h1>
		<div class="cal">
			<div id="ctitle" class="text-center">
				<a th:href="@{/schedule/calendar(year=${calMap.year-1},month=${calMap.month})}">︎◁</a>
				<a th:href="@{/schedule/calendar(year=${calMap.year},month=${calMap.month-1})}">◀</a>
				<span class="y" th:text="${calMap.year}"></span>
				<span>년</span>
				<span class="m" th:text="${calMap.month}"></span>
				<span>월</span>
				<a th:href="@{/schedule/calendar(year=${calMap.year},month=${calMap.month+1})}">►︎︎</a>
				<a th:href="@{/schedule/calendar(year=${calMap.year+1},month=${calMap.month})}">▷</a>
			</div>
			<div id="thead" class="row row-cols-7 text-center">
				<div class="col">일</div><div class="col">월</div><div class="col">화</div>
				<div class="col">수</div><div class="col">목</div><div class="col">금</div>
				<div class="col">토</div>
			</div>
			<div id="tbody">
				<div class="row row-cols-7">
					<div id="col" 
						 class="col" 
						 th:if="${calMap.dayOfWeek > 1}" 
						 th:each="b : ${#numbers.sequence(0,calMap.dayOfWeek%7)}">&nbsp;
					</div>
					<div id="col" 
						 class="col" 
						 th:each="d : ${#numbers.sequence(1,calMap.lastDay)}">
						<a th:href="@{/schedule/calboardlist(year=${calMap.year},month=${calMap.month},date=${d})}" th:text="${d}" class="d"></a>
						<a th:href="@{/schedule/addcalboardform(year=${calMap.year},month=${calMap.month},date=${d})}">
							<img class="pen" th:src="@{/img/pen.png}" alt="일정추가">
						</a>
						<!-- i값과 clist의 날짜와 비교해서 일정 출력 -->
						[(${@util.getCalViewList(d,clist)})]
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
</body>
</html>