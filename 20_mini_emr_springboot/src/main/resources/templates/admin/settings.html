<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>병원 설정</title>
    <link type="text/css" th:href="@{/css/adminCommon.css}" rel="stylesheet">
    <link type="text/css" th:href="@{/css/adminSetting.css}" rel="stylesheet">
</head>
<body>

    <nav class="sidebar">
        <h2>병원 관리 (ADMIN)</h2>
        <ul>
            <li><a href="/admin/">대시보드</a></li>
            <li><a href="/admin/accounts">계정 관리</a></li>
            <li><a href="/admin/settings"><b>병원 설정</b></a></li>
            <li><a href="/admin/schedules"><b>스케줄 관리</b></a></li>
            <li><a href="/user/logout">로그아웃</a></li>
        </ul>
    </nav>

    <main class="content">
        <h1>병원 설정</h1>
        <hr>
        
        <h2>진료과 관리 (Departments)</h2>
        <p>병원에서 운영하는 진료과를 등록하고 관리합니다.</p>

        <button class="btn" onclick="openModal('modal-dept-form')">
            ➕ 새 진료과 등록
        </button>

        <table>
            <thead>
                <tr>
                    <th width="30%">진료과 ID (Dept ID)</th>
                    <th width="50%">진료과 이름</th>
                    <th>관리</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="dept : ${departmentList}">
                    <td th:text="${dept.id}">1</td>
                    <td th:text="${dept.name}">내과</td>
                    <td>
                        <button class="btn">수정</button>
                        <button class="btn btn-danger">삭제</button>
                    </td>
                </tr>
                
                <tr th:if="${#lists.isEmpty(departmentList)}">
                    <td colspan="3" style="text-align: center;">등록된 진료과가 없습니다.</td>
                </tr>
            </tbody>
        </table>

        </main>

    <div id="modal-dept-form" class="modal">
        <div class="modal-content">
            <h2>새 진료과 등록</h2>
            <form id="createDeptForm">
                <label for="deptName">진료과 이름:</label>
                <input type="text" id="deptName" name="name" required>

                <button type="submit" class="btn">저장</button>
                <button type="button" class="btn btn-danger" onclick="closeModal('modal-dept-form')">취소</button>
            </form>
        </div>
    </div>
    
    <script>
        // 모달 제어 함수 (ID를 받아 처리)
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
        $(document).ready(function() {
            
            // "createDeptForm" 폼이 submit될 때 실행
            $("#createDeptForm").on("submit", function(e) {
                
                e.preventDefault(); // 기본 새로고침 방지

                var formData = {
                    name: $("#deptName").val() // DTO/Command의 'name' 필드와 일치
                };

                // /api/admin/departments 컨트롤러 호출
                $.ajax({
                    type: "POST",
                    url: "/admin/departments", 
                    contentType: "application/json",
                    data: JSON.stringify(formData),
                    
                    success: function(response) {
                        alert("진료과가 성공적으로 등록되었습니다.");
                        closeModal('modal-dept-form');
                        location.reload(); // 목록 새로고침
                    },
                    error: function(xhr) {
                        alert(xhr.responseJSON.message || "등록에 실패했습니다.");
                    }
                });
            });
        });
    </script>

</body>
</html>